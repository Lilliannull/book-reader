<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ file_name }}</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        button {
            margin-right: 10px;
            padding: 6px 12px;
        }
        pre {
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <h2>{{ file_name }}</h2>

    <button onclick="startReading()">▶️ Start</button>
    <button onclick="pauseReading()">⏸️ Pause</button>
    <button onclick="resumeReading()">⏯️ Resume</button>
    <button onclick="stopReading()">⏹️ Stop</button>

    <pre id="book-content">{{ content }}</pre>

    <br><br><a href="/">⬅ Back</a>

    <script>
        let utterance = null;
        let isPaused = false;
        let isStarted = false;

        function initUtterance() {
            if (!utterance) {
                const text = document.getElementById("book-content").innerText.slice(0, 1000);
                utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = "en-US";

                utterance.onend = function() {
                    isStarted = false;
                    isPaused = false;
                    utterance = null;
                    console.log("朗读结束");
                };
            }
        }

        function startReading() {
            speechSynthesis.cancel(); // 确保不会重叠
            initUtterance();
            isPaused = false;
            isStarted = true;
            speechSynthesis.speak(utterance);
        }

        function pauseReading() {
            if (isStarted && !isPaused && speechSynthesis.speaking) {
                speechSynthesis.pause();
                isPaused = true;
            }
        }

        function resumeReading() {
            if (isStarted && isPaused && speechSynthesis.paused) {
                speechSynthesis.resume();
                isPaused = false;
            }
        }

        function stopReading() {
            speechSynthesis.cancel();
            isPaused = false;
            isStarted = false;
            utterance = null;
        }
    </script>

</body>
</html>
